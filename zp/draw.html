<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>福利大转盘</title>
		<link rel="stylesheet" type="text/css" href="static/css/style.css">
		<link rel="stylesheet" type="text/css" href="static/css/draw.css">
		<script type="text/javascript" src="https://cdn.staticfile.org/jquery/3.3.1/jquery.min.js"></script>
		<script type="text/javascript" src="static/js/awardrotate.js"></script>
		<script type="text/javascript" src="static/js/rem.js"></script>
		<script type="text/javascript" src="static/js/common.js"></script>
		<script type="text/javascript" src="static/js/draw.js"></script>
		<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
		<script type="text/javascript">
			$(function(){
				//页面所有元素加载完毕后执行drawRouletteWheel()方法对转盘进行渲染
				drawRouletteWheel();
			})
		</script>
	</head>
	<body>
		<img class="bg-title" src="static/images/bg_title.png" alt="">
		<img src="static/picture/1.png" id="shan-img" style="display:none;" />
		<img src="static/images/icon_light.png" id="light" style="display:none;" />
		<img src="static/picture/2.png" id="sorry-img" style="display:none;" />
		<div class="banner">
			<div class="turnplate">
				<canvas class="item" id="wheelcanvas" width="422px" height="422px"></canvas>
				<img class="pointer" src="static/images/icon_start.png" />
			</div>
		</div>
		<div class="free-times-box">
			<a class="free-times" href="javascript:;">今日免费次数：<span class="js_times">7</span>次</a>
		</div>	
	</body>
	<script>
		$(function(){
			// share();
		})
		function share(){
      var timestamp;//时间戳
      var nonceStr;//随机串
      var signature;//签名
      var appId;//签名
      var url = window.location;
			var payConfigURL = ctx+"/wx/pay/getwxconfig.spv";
			
      $.post(payConfigURL,{"url":""+url},function(data, status){
				var resultCode = data.resultCode;
				
        if("success" == resultCode) {
          var payConfig = data.values;
          appId = payConfig.appId;
          timestamp = payConfig.timeStamp;
          nonceStr = payConfig.nonceStr;
          signature = payConfig.signature;
          wx.config({
            debug : false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId : appId, // 必填，公众号的唯一标识
            timestamp : timestamp, // 必填，生成签名的时间戳
            nonceStr : nonceStr, // 必填，生成签名的随机串
            signature : signature,// 必填，签名，见附录1
            jsApiList : ['onMenuShareAppMessage','onMenuShareTimeline']// 必填，需要使用的JS接口列表，所有JS接口列表见附录2
          });

          wx.ready(function(){
            // wx.hideOptionMenu();
            wx.onMenuShareTimeline({
            	title: '福利大转盘',
              desc: '福利大转盘',
              link: _domainCtx+'/wx/index.html',
              imgUrl: _domainCtx+'/wx/public/images/logo_pic.jpg',
              success: function () {
                // 用户确认分享后执行的回调函数
                alert('分享到朋友圈成功');
              },
              cancel: function () {
                // 用户取消分享后执行的回调函数
                // alert('你没有分享到朋友圈');
                
              }
            });
            wx.onMenuShareAppMessage({
              title: '福利大转盘',
              desc: '福利大转盘',
              link: _domainCtx+'/wx/index.html',
            	imgUrl: _domainCtx+'/wx/public/images/logo_pic.jpg',
              trigger: function (res) {
                // 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
              },
              success: function (res) {
                //  alert('分享给朋友成功');
              },
              cancel: function (res) {
                // alert('你没有分享给朋友');
              },
              fail: function (res) {
                alert(JSON.stringify(res));
              }
            });
          });
        }
      });
    }
	</script>
</html>